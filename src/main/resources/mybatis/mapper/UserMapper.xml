<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="subak.example.subak.dao.UserDAO">
	<!-- 회원가입 -->
	<insert id="insertUser" parameterType="UserDTO">
		insert into "user"
		(username, password, email, nickname, created_at)
		values (#{username},
		#{password}, #{email}, #{nickname}, sysdate)
	</insert>

	<!-- 아이디 중복 체크 -->
	<select id="checkUsername" parameterType="string"
		resultType="int">
		select count(*)
		from "user"
		where username = #{username}
	</select>

	<!-- 닉네임 중복 체크 -->
	<select id="checkNickname" parameterType="string"
		resultType="int">
		SELECT COUNT(*) FROM "user"
		WHERE nickname = #{nickname}
	</select>

	<!-- 로그인 -->
	<select id="login" parameterType="LoginRequestDTO"
		resultType="SessionUserVO">
		select id, username, email, nickname
		from "user"
		where
		username = #{username} and password = #{password}
	</select>

	<!-- 내 마이페이지 -->
	<select id="findById" parameterType="long"
		resultType="UserInfoVO">
		select id, nickname, bio, image_url,<!--해시시 변경 --> password
		from "user"
		where id =
		#{id}
	</select>

	<!-- 아이디 찾기 -->
	<select id="findUserByEmail" parameterType="string"
		resultType="subak.example.subak.domain.UserDTO">
		SELECT id, username, email
		FROM "user"
		WHERE email = #{email}
	</select>


	<!-- 비밀번호 확인 -->
	<select id="getPasswordByUserId" resultType="String">
		SELECT password FROM
		user WHERE id = #{id}
	</select>
	
	<!-- 업데이트 닉네임 -->
	<update id="updateNickname">
		UPDATE "user"
		SET nickname = #{nickname}
		WHERE id = #{id}
	</update>
	
	<!-- 업데이트 자기소개 -->
	<update id="updateBio">
		UPDATE "user"
		SET bio = #{bio}
		WHERE id = #{id}
	</update>
	
	<!-- 업데이트 패스워드 id (Primary key)기준 -->
	<update id="updatePasswordById">
		UPDATE "user"
		SET password = #{password}
		WHERE id = #{id}
	</update>
	
	<!-- 프로필 이미지 변경 -->
	<update id="updateImageUrl" parameterType="map">
		UPDATE "user"
		SET image_url = #{imageUrl}
		WHERE id = #{id}
	</update>
	
</mapper>








